# Chrobelias - Chrobak normal form-based Exponential Linear Integer Arithmetic Solver

__ChrobELIAS__ is a theorem prover (SMT-solver) for deciding existential **E**xponential-**L**inear **I**nteger **A**rithmetic with regular constraints $\langle\mathbb{N}; 0, 1, +, x\mapsto 2^x, \mathscr{R}, =,\leq\rangle$. The prover is based on automata theory (see [existential generalised Semёnov arithmetic](https://arxiv.org/abs/2306.14593)) and uses Chrobak Normal Form of sub-NFAs to linearise exponential occurrences of the variables. 

## Building
To build the project you need the following dependencies to be installed:
- OPam - OCaml package manager.
- OCaml >5.0.

The dependencies can be installed using the bash commands
```bash
# Installing OCaml package manager and OCaml 5.2.
bash -c "sh <(curl -fsSL https://opam.ocaml.org/install.sh)"
opam switch create 5.2.0+flambda --packages=ocaml-variants.5.2.0+options,ocaml-option-flambda --yes
```
ChrobELIAS is built as follows:

```bash
# Installing project dependencies.
opam install . --deps-only --with-test

# Building the project and its tests.
opam exec -- dune build @check @all
```

The executable binary is available in the `_build` dir.

## Usage

Supports `.smt2` files in `QF_LIA` and exponents via the binary `exp` function symbol.

```bash
./_build/default/bin/chro.exe <path-to-smt2-file>
```

Simple `.smt2` files for ChrobELIAS can be found in [examples](https://github.com/Chrobelias/Chrobelias/tree/main/examples).

```bash
# Frobenius coin problem for 7 11 13
./_build/default/bin/chro.exe ./examples/fcp_7_11_13.smt2

# Proof ExEy y >= 0 & x = 2**y & x > 4.
./_build/default/bin/chro.exe ./examples/basic-exp-sat.smt2
```

## Chrobelias REPL

Chrobelias offers CLI REPL for experimenting. It allows defining predicates, proving theorems, and visualizing the automata which are built during the execution. By default, opam builds an executable in `./_build/default/bin/chro_repl.exe`. By starting it, you are redirected to REPL for theorem proving: 

```bash
ledit ./_build/default/bin/chro_repl.exe
```

Using common unix `ledit` allows navigating through the input and switching the history of executed commands.
You can list the examples and the information on the usage of REPL via the `help` command.

For the first-order formulas, the prover uses the following syntax: 

```
formula := (formula)
         | ~formula                    (* not *)
         | formula & formula           (* and *)
         | formula '|' formula         (* or *)
         | formula -> formula          (* imply *)
         | formula <-> formula         (* iff *)
         | E var formula               (* exists *)
         | A var formula               (* forall *)
         | atomic_formula

atomic_formula := term = term          (* equals *)
                | term != term         (* not equals *)
                | term < term          (* less than *)
                | term > term          (* greater than *)
                | term <= term         (* less or equal *)
                | term >= term         (* greater or equal *)
                | pred term+           (* custom predicate *)

pred := [a-z_][a-z_0-9]*

term := (term)
      | const * term | term * const    (* multiply by const *)
      | term + term                    (* sum *)
      | 2**term                        (* 2 to the power of... *)
      | var
      | const
var := [a-z_][a-z_0-9]*
const := [0-9]+
```
Universal quantifiers are only allowed when 
- all universally quantified variables have only linear occurrences in the formula;
- there is no existential quantifier over a variable with exponential occurrences within the scope of a universal quantifier. 

Examples:
```
> eval Ax Ey x = y + 1
  sat

> let even x = Ey x = 2*y
> eval AxAyAz x + y = z & even(x) & even(y) -> even(z + 1)
  unsat

> eval AxAyAz x + y = z & even(x) & even(y) -> even(z)
  sat

> eval ExEyEz 2**x = 2**y + 2**z + 7
  sat
```

## Acknowledgements

This repository contains unit-tests and examples based on the Frobenius coin problem benchmarks from the [SMT-LIB benchmark submission repository](https://github.com/SMT-LIB/benchmark-submission) licensed under [Creative-Commons 4.0](https://creativecommons.org/licenses/by/4.0/) generated by Vojtěch Havlena, Michal Hečko, Lukáš Holík, Ondřej Lengál. There are modified Frobenius coin problem benchmarks involving exponents.

Also, we use custom SMT-lib v2.6 `exp` syntax and examples from [SwInE](https://github.com/ffrohn/swine) by [Florian Frohn](https://ffrohn.github.io/) licensed under [LGPL v2.1](https://github.com/ffrohn/swine/blob/master/LICENSE).
