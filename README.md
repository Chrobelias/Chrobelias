# MacadamiaSolver

__MacadamiaSolver__ (or simple __MandmS__ as an acronym for MacANDaMia solver) is a theorem prover (SMT-solver) in Presburger Arithmetic based on the finite-automata approach for deciding. It also supports [existential Semёnov arithmetic](https://arxiv.org/abs/2306.14593) (i.e. existential theory `<N, 2**x, +, =>`).

## Dependencies
To build the project you'll need these dependencies to be installed:
- OPam - OCaml package manager.
- OCaml >5.0.

You may install the dependencies using the following bash commands:
```bash
# This would install OCaml package manager and the OCaml 5.2 itself.
bash -c "sh <(curl -fsSL https://opam.ocaml.org/install.sh)"
opam switch create 5.2.0+flambda --packages=ocaml-variants.5.2.0+options,ocaml-option-flambda --yes
```

## Building

The MacadamiaSolver project can be built like this:

```bash
# Installing project dependencies.
opam install . --deps-only --with-test

# Building the project and its tests.
opam exec -- dune build @check @all
```

The executable binary is available in the `_build` dir.

## Usage

You might execute `.smt2` files in `LIA` or custom exponent arithmetic with MacadamiaSolver that's defined with `ALL` in .smt2. Later allows you to use custom `exp` functional symbol.

```bash
./_build/default/bin/smtlib.exe <path-to-smt2-file>
```

## Custom REPL

During the development REPL for the tool has been developed. It allows defining predicates, proving theorems and visualizing the automaton the solver builds. By default opam builds an executable in `./_build/default/bin/mandams.exe`. Starting it up brings you to REPL for evaluating theorem proving. We strongly encourage you to run it the following way.

```bash
ledit ./_build/default/bin/mandams.exe
```

Using common unix `ledit` allows navigating through the input and switching the history of executed commands.

You might list the examples and information on how to use the REPL using the `help` commands.

MacadamiaSolver uses the syntax defined by the following grammar rules for expression first-order logic statements:

```
formula := (formula)
         | ~formula                    (* not *)
         | formula & formula           (* and *)
         | formula '|' formula         (* or *)
         | formula -> formula          (* imply *)
         | formula <-> formula         (* iff *)
         | E var formula               (* exists *)
         | A var formula               (* forall *)
         | atomic_formula

atomic_formula := term = term          (* equals *)
                | term != term         (* not equals *)
                | term < term          (* less than *)
                | term > term          (* greater than *)
                | term <= term         (* less or equal *)
                | term >= term         (* greater or equal *)
                | pred term+           (* custom predicate *)

pred := [a-z_][a-z_0-9]*

term := (term)
      | const * term | term * const    (* multiply by const *)
      | term + term                    (* sum *)
      | 2**term                        (* 2 to the power of... *)
      | var
      | const
var := [a-z_][a-z_0-9]*
const := [0-9]+
```

Example usages:
```
> eval Ax Ey x = y + 1
  sat

> let even x = Ey x = 2*y
> eval AxAyAz x + y = z & even(x) & even(y) -> even(z + 1)
  unsat

> eval AxAyAz x + y = z & even(x) & even(y) -> even(z)
  sat

> evalsemenov 2**x = 2**y + 2**z + 7
  sat
```


## Future development

Our future plans include:
- Supporting SMT-Lib for evaluating benchmarks

## Acknowledgements

This repository contains unit-tests and examples based on the Frobenious coin problem benchmarks from the [SMT-LIB benchmark submission repository](https://github.com/SMT-LIB/benchmark-submission) licensed under [Creative-Commons 4.0](https://creativecommons.org/licenses/by/4.0/) generated by Vojtěch Havlena, Michal Hečko, Lukáš Holík, Ondřej Lengál.
